<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Central Race - Funcionários</title>
<link rel="icon" href="https://imgur.com/0iskhD3.png">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body { 
  font-family: Inter, sans-serif; 
  background:#f4f4f4; 
}

/* ===== TOPBAR ===== */
.topbar{
  background:#2b2f33;
  color:#fff;
  padding:12px 0;
}

.logo{
  font-weight:700;
  letter-spacing:.6px;
  font-size:18px;
}

.nav-links a{
  color:#fff;
  text-decoration:none;
  margin-left:18px;
  font-weight:600;
}

/* ===== TITULOS ===== */
.subtitulo {
  background:#ddd;
  text-align:center;
  font-weight:700;
  padding:6px;
  margin:30px 0 15px;
}

/* ===== CARDS ===== */
.card-employee {
  border-radius:16px;
  overflow:hidden;
  position:relative;
}

/* IMAGEM PROTEGIDA */
.card-employee img {
  height:180px;
  width:100%;
  object-fit:cover;
  pointer-events:none;
  user-select:none;
  -webkit-user-drag:none;
}

/* OVERLAY INVISÍVEL */
.card-employee::after{
  content:"";
  position:absolute;
  inset:0;
  z-index:5;
}

/* ===== BOTAO REMOVER ===== */
.btn-remover {
  position:absolute;
  top:8px;
  right:8px;
  width:30px;
  height:30px;
  border-radius:50%;
  background:#dc3545;
  color:#fff;
  border:none;
  display:none;
  font-weight:700;
  z-index:10;
}

.gerencia-mode .btn-remover {
  display:block;
}

/* ===== ADMIN ===== */
.admin-btn {
  position:fixed;
  right:20px;
  bottom:20px;
  z-index:1001;
}
.admin-menu {
  position:fixed;
  right:-380px;
  top:0;
  width:380px;
  height:100%;
  background:#fff;
  box-shadow:-4px 0 20px rgba(0,0,0,.2);
  padding:20px;
  transition:.3s;
  z-index:1000;
}
.admin-menu.open { right:0; }
</style>
</head>

<body>

<header class="topbar">
  <div class="container d-flex justify-content-between align-items-center">
    <div class="d-flex align-items-center gap-3">
      <img src="https://imgur.com/0iskhD3.png" style="height:70px;border-radius:8px">
      <div class="logo">Central Race</div>
    </div>

    <nav class="d-none d-md-flex nav-links">
      <a href="index.html">Início</a>
      <a href="tabela.html">Preços</a>
      <a href="relatorio.html">Relatório</a>
      <a href="funcionarios.html">Funcionários</a>
    </nav>
  </div>
</header>

<main class="container my-5">
  <h2 class="text-center mb-4">Nossa Equipe</h2>
  <div id="listaCargos"></div>
</main>

<button class="btn btn-dark admin-btn" onclick="abrirAdmin()">Admin</button>
<button class="btn btn-danger admin-btn" style="bottom:70px" onclick="acessoGerencia()">Acesso Gerência</button>

<div class="admin-menu" id="adminMenu">
  <h5>Painel Admin</h5>
  <hr>

  <label>Cargo</label>
  <select id="cargo" class="form-select mb-2"></select>

  <label>Nome</label>
  <input id="nome" class="form-control mb-2">

  <label>Foto</label>
  <input id="foto" type="file" accept="image/*" class="form-control mb-3">

  <button class="btn btn-primary w-100" onclick="adicionarVaga()">Adicionar vaga</button>
</div>

<script type="module">
/* ===== CARGOS ===== */
const CARGOS = ["Responsável Mecânico","Líder","Sub-Líder","Gerente","Supervisor de Turnagem","Turnagem","Reparo"];

/* ===== FIREBASE ===== */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, doc, getDocs, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const app = initializeApp({
  apiKey: "AIzaSyD2zieCD4d-_olcWE6O0QlepyxWLGhyI",
  authDomain: "centralrace-c4ad0.firebaseapp.com",
  projectId: "centralrace-c4ad0"
});
const db = getFirestore(app);

/* ===== CLOUDINARY ===== */
const CLOUD_NAME="dfyiwxdhn";
const UPLOAD_PRESET="funcionarios";

async function uploadImagem(file){
  const fd=new FormData();
  fd.append("file",file);
  fd.append("upload_preset",UPLOAD_PRESET);
  const res=await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`,{method:"POST",body:fd});
  return (await res.json()).secure_url;
}

/* ===== SENHAS ===== */
const SENHA_ADMIN="admin123";
const SENHA_GERENCIA="gerencia456";
let gerenciaAtiva=false;

/* ===== ADMIN ===== */
window.abrirAdmin=()=>{
  if(prompt("Senha Admin:")===SENHA_ADMIN){
    adminMenu.classList.toggle("open");
  }
};

/* ===== GERÊNCIA ===== */
window.acessoGerencia=()=>{
  if(prompt("Senha Gerência:")===SENHA_GERENCIA){
    gerenciaAtiva=true;
    document.body.classList.add("gerencia-mode");
    alert("Modo Gerência ativado");
  } else alert("Senha incorreta");
};

/* ===== ADICIONAR ===== */
window.adicionarVaga=async()=>{
  if(!nome.value||!foto.files[0])return alert("Preencha tudo");
  const img=await uploadImagem(foto.files[0]);
  const ref=doc(db,"vagas",cargo.value);

  let lista=[];
  const snap=await getDocs(collection(db,"vagas"));
  snap.forEach(d=>{if(d.id===cargo.value)lista=d.data().lista||[]});

  lista.push({nome:nome.value,foto:img});
  await setDoc(ref,{lista});

  nome.value="";foto.value="";
  renderizar();
};

/* ===== REMOVER ===== */
window.removerVaga=async(cargoNome,index)=>{
  if(!gerenciaAtiva)return alert("Acesso negado");
  if(!confirm("Remover?"))return;

  const ref=doc(db,"vagas",cargoNome);
  let lista=[];
  const snap=await getDocs(collection(db,"vagas"));
  snap.forEach(d=>{if(d.id===cargoNome)lista=d.data().lista||[]});

  lista.splice(index,1);
  await setDoc(ref,{lista});
  renderizar();
};

/* ===== RENDER ===== */
async function renderizar(){
  listaCargos.innerHTML="";
  cargo.innerHTML="";
  const dados={};

  const snap=await getDocs(collection(db,"vagas"));
  snap.forEach(d=>dados[d.id]=d.data().lista||[]);

  CARGOS.forEach(c=>{
    cargo.innerHTML+=`<option>${c}</option>`;
    const vagas=dados[c]||[];

    listaCargos.innerHTML+=`
    <div class="subtitulo">${c}</div>
    <div class="row justify-content-center mb-4">
      ${vagas.map((v,i)=>`
      <div class="col-md-3 mb-3">
        <div class="card card-employee">
          <button class="btn-remover" onclick="removerVaga('${c}',${i})">×</button>
          <img src="${v.foto}" draggable="false">
          <div class="card-body text-center">
            <h5>${v.nome}</h5>
            <p class="small text-muted">${c}</p>
          </div>
        </div>
      </div>`).join("")}
    </div>`;
  });
}

renderizar();

/* ===== PROTEÇÃO GLOBAL ===== */
document.addEventListener("contextmenu",e=>e.preventDefault());
document.addEventListener("dragstart",e=>e.preventDefault());
document.addEventListener("keydown",e=>{
  if(e.key==="F12"||(e.ctrlKey&&["U","I","J","C","S"].includes(e.key.toUpperCase()))){
    e.preventDefault();
  }
});
</script>

</body>
</html>
